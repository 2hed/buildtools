<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask TaskName="GenerateResourcesCode" AssemblyFile="$(ToolsDir)Microsoft.DotNet.Build.Tasks.dll" />

  <PropertyGroup>
    <ResourcesSourceOutputDirectory Condition="'$(ResourcesSourceOutputDirectory)' == ''">$(MSBuildProjectDirectory)\Resources</ResourcesSourceOutputDirectory>
    <StringResourcesPath Condition="'$(StringResourcesPath)'=='' And Exists('$(ResourcesSourceOutputDirectory)\Strings.resx')">$(ResourcesSourceOutputDirectory)\Strings.resx</StringResourcesPath>
    <ResourceSRPath Condition="'$(ResourceSRPath)'==''">$(ResourcesSourceOutputDirectory)\SR.cs</ResourceSRPath>
    <IntermediateResOutputFileFullPath Condition="'$(MSBuildProjectExtension)' == '.csproj'">$(IntermediateOutputPath)SR.cs</IntermediateResOutputFileFullPath>
    <IntermediateResOutputFileFullPath Condition="'$(MSBuildProjectExtension)' == '.vbproj'">$(IntermediateOutputPath)SR.vb</IntermediateResOutputFileFullPath>
  </PropertyGroup>
  
  <PropertyGroup Condition="'$(StringResourcesPath)'!=''">
      <CompileDependsOn>
          GenerateResourcesSource;
          $(CompileDependsOn);
      </CompileDependsOn>
  </PropertyGroup>

  <Target Name="GenerateResourcesSource"
      Condition="'$(StringResourcesPath)'!=''"
      Inputs="$(StringResourcesPath)"
      Outputs="$(IntermediateResOutputFileFullPath)">
    
    <GenerateResourcesCode 
        ResxFilePath="$(StringResourcesPath)" 
        IntermediateFilePath="$(IntermediateResOutputFileFullPath)" 
        OutputSourceFilePath="$(ResourceSRPath)" 
        AssemblyName="$(AssemblyName)" >
    </GenerateResourcesCode>

    <ItemGroup>
      <FileWrites Include="$(IntermediateResOutputFileFullPath)" />
    </ItemGroup>
  </Target>
  
  <Import Project="ResourcesIncludes.targets" Condition="Exists('$(StringResourcesPath)') And Exists('$(ResourceSRPath)') And'$(ExcludeResourcesTarget)'==''"/>
</Project>
